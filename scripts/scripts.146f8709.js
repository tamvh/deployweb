angular.module("zcloud",["ngMaterial","ngMdIcons","ngRoute","ngResource","ngCookies","gRecaptcha","ngRoute"]).run(["$location",function(a){}]).config(["$routeProvider","$locationProvider","$httpProvider",function(a,b,c){a.when("/",{templateUrl:"/views/dashboard.html",controller:"DashboardCtrl"}).when("/dashboard",{templateUrl:"/views/dashboard.html",controller:"DashboardCtrl"}).when("/login",{templateUrl:"/views/login.html",controller:"LoginCtrl"}).when("/signup",{templateUrl:"/views/signup.html",controller:"SignupCtrl"}).when("/profile",{templateUrl:"/views/profile.html",controller:"ProfileCtrl"}).when("/device",{templateUrl:"/views/devices.html",controller:"DevicesCtrl"}).when("/about",{templateUrl:"/views/index.html"}).when("/search",{templateUrl:"/views/search.html"}).when("/history",{templateUrl:"/views/history.html",controller:"HistoryCtrl"}).otherwise({redirectTo:"/"}),c.interceptors.push("authInterceptor")}]),angular.module("zcloud").factory("Settings",["$location",function(a){var b=a.host()+":"+a.port();return b+="/call",{httpServer:"http://"+b,websocketServer:"ws://"+a.host()+":9981"}}]).config(["$mdThemingProvider",function(a){var b=a.extendPalette("light-blue",{contrastDefaultColor:"light",contrastDarkColors:["50"],50:"ffffff"});a.definePalette("customBlue",b),a.theme("default").primaryPalette("customBlue",{"default":"500","hue-1":"50"}).accentPalette("pink"),a.theme("input","default").primaryPalette("grey")}]),angular.module("zcloud").factory("User",["$http","$cookies","$window","Settings",function(a,b,c,d){return{register:function(c,e,f,g){a.post(d.httpServer+"/api/user/register",{email:c,password:e}).success(function(a){return a.error?void g(a.error):(b.put("token",a.jwt),b.put("session",JSON.stringify(a)),void g(void 0,a.user))}).error(function(){g("Register user failed!")})},login:function(c,e,f){a.post(d.httpServer+"/api/user/login",{email:c,password:e}).success(function(a){return a.error?void f(a.error):(b.put("token",a.jwt),b.put("session",JSON.stringify(a)),b.put("apikey",a.user.apikey),b.put("email",a.user.email),void f(void 0,a.user))}).error(function(){f("Log in failed!")})},logout:function(){b.remove("token"),b.remove("session")},isLoggedIn:function(){return b.get("session")?!0:!1},setPassword:function(b,c,e){a.post(d.httpServer+"/api/user/password",{oldPassword:b,newPassword:c}).success(function(a){return a.error?void e(a.error):void e(void 0)}).error(function(){e("Change password failed!")})},getUser:function(){var a=b.get("session");if(void 0===a)return{};var c=JSON.parse(a);return c.user},getToken:function(){var a=b.get("token");return a},isActive:function(){var a=b.get("token");if(!a)return!1;var d=a.substring(a.indexOf(".")+1,a.lastIndexOf(".")),e=c.atob(d),f=JSON.parse(e);return!!f.isActivated},isExpire:function(){var a=b.get("token");if(!a)return!1;var d=a.substring(a.indexOf(".")+1,a.lastIndexOf(".")),e=c.atob(d),f=JSON.parse(e);return f.isActivated?!1:Date.now()>new Date(f.validExpire).getTime()},activeAccount:function(b){a.get("/api/user/activeAccount").success(function(a){b(a)}).error(function(){b("Active Account failed,Please retry!")})}}}]),angular.module("zcloud").factory("Devices",["$resource","$window","$rootScope","Settings","WS","User","$cookies",function(a,b,c,d,e,f,g){var h=a(d.httpServer+"/api/user/device/:id",{id:"@deviceid"},{add:{method:"POST",url:d.httpServer+"/api/user/device/add"}}),i=a(d.httpServer+"/api/user/device/history/:deviceid/:count",{deviceid:"@deviceid",count:"count"}),j=[],k={},l=[],m=!1,n=function(a,b,c,d){i.query({deviceid:b,count:a},function(a){l=a,c(l)},d)},o=function(a,b){h.query(function(b){j=b,angular.forEach(j,function(a){k[a.deviceid]=a}),a(j)},b)},p=function(a,b,c){var d=k[a];return y(),d?void b(d.params):void 0},q=function(a,b,c){var d=k[a];return d?void b(d):void h.get({id:a},function(c){d=c,j.push(c),k[a]=d,b(d)},function(){c()})},r=function(a,b,c){var d=k[a];return d?void d.$remove(function(e){return e.error?void c():(j.splice(j.indexOf(d),1),delete k[a],void b(d))},c):void c()},s=function(a,b,c){h.add(a,function(a){return a.error?void c():(j.push(a),k[a.deviceid]=a,void b(a))},c)},t=function(b,c,e){var f=k[b.deviceid],g=a(d.httpServer+"/api/user/device/:address",{address:"@address"});return f?void g.save({address:f.address},b,function(a){return a.error?void e():(k[a.deviceid]=a,void c(a))},e):void 0},u=function(a,b,c){h.save(a,function(a){return a.error?void c():(j.push(a),k[a.deviceid]=a,void b(a))},c)},v={},w=function(a,b,c){angular.isObject(a)&&(a.sequence=""+Date.now(),v[a.sequence]={success:b,error:c},e.send(a))},x=function(){y()},y=function(){m||(m=!0,e.addListener(function(a){if(console.log("receive data from WS:",a),"action"in a){var b=k[a.data.deviceid];if(console.log("device:",b),!b&"create"!==a.action)return;if("sysmsg"===a.action)return"online"in a.params&&(b.online=a.params.online),void c.$apply();if("update"===a.action)return b.params=b.params||{},angular.extend(b.params,a.data.params),void c.$apply();if("create"===a.action){if(k[a.data.deviceid]===a.data)return;return j.push(a.data),k[a.data.deviceid]=a.data,void c.$apply()}if("delete"===a.action){var b=k[a.data.deviceid];return j.splice(j.indexOf(b),1),delete k[a.data.deviceid],void c.$apply()}"updateinfo"===a.action}else if("error"in a){if(!("sequence"in a))return;var d=v[a.sequence];if(!d)return;a.error?d.error():d.success(a)}}),e.send({content_type:1,userId:g.get("email"),apikey:g.get("apikey")}))};return{init:x,history:n,query:o,add:s,get:q,save:u,update:t,remove:r,send:w,getValue:p}}]),angular.module("zcloud").factory("authInterceptor",["$window","$q","$cookies",function(a,b,c){return{request:function(a){return a.headers=a.headers||{},c.get("token")&&(a.headers.Authorization="Bearer "+c.get("token")),a},response:function(b){return 401===b.status?void a.alert("Restricted area, please log in first!"):b}}}]),angular.module("zcloud").factory("WS",["Settings",function(a){var b,c,d=[],e=a.websocketServer+"/api/ws",f=function(a){b=new WebSocket(e),b.addEventListener("message",function(a){try{var b=JSON.parse(a.data);d.forEach(function(a){a(b)})}catch(c){}}),b.addEventListener("error",function(){console.log("WebSocket Error")}),b.addEventListener("close",function(){console.log("WebSocket closed!")}),b.onmessage=function(a){c=a.data},"function"==typeof a&&b.addEventListener("open",a)};return f(),{send:function(a){return"object"==typeof a&&null!==a?(a.userAgent="web",a=angular.toJson(a),b&&1===b.readyState?void b.send(a):void f(function(){b.send(a)})):void 0},addListener:function(a){d.push(a)},removeListener:function(a){var b=d.indexOf(a);-1!==b&&d.splice(b,1)}}}]),function(){function a(a,b,c,d,e,f,g){var h=!1,i=function(){j()},j=function(){h||(h=!0,d.addListener(function(a){return console.log("DB: receive data from WS:",a),"action"in a&&(console.log("DB: device:",a.data),"update"===a.action)?void b.$broadcast("DEVICE_DATA_UPDATE_"+a.data.deviceid,a.data):void 0}),d.send({content_type:1,userId:f.get("email"),apikey:f.get("apikey")}))};return{init:i}}angular.module("zcloud").factory("Dashboard",["$resource","$rootScope","Settings","WS","Widgets","$cookies","$interval",a])}(),angular.module("zcloud").factory("Widgets",["$resource","Settings",function(a,b){var c=a(b.httpServer+"/api/web/widget/:id",{id:"@id"},{removeall:{method:"DELETE",url:b.httpServer+"/api/web/widget/all"},add:{method:"POST"}}),d={},e={},f=function(a,b){c.query(function(b){d=b,angular.forEach(d,function(a){e[a.id]=a}),a(d)},b)},g=function(a,b,c){var f=e[a];return d?void b(f):void 0},h=function(a,b,d){var e=c.get({id:a},function(){});return e?void b(e):void d()},i=function(a,b,c){var f=e[a];return console.log("remove widget: ",f),f?void f.$remove(function(g){return g.error?void c():(d.splice(d.indexOf(f),1),delete e[a],void b(f))},c):void c()},j=function(a,b,f){a.action="widgets.add",console.log("add widget: ",a),c.add(a,function(a){return a.error?void f():(d.push(a.data),e[a.data.id]=a.data,void b(a.data))},f)},k=function(a,b,d){a.action="widgets.update",console.log("save widget: ",a),c.save(a,function(a){return a.error?void d():void b(a)},d)};return{query:f,add:j,get:h,save:k,remove:i,getValue:g}}]),angular.module("zcloud").factory("Search",["$cookies",function(a){return{setKey:function(b){a.put("key_search",b)},getKey:function(){return a.get("key_search")}}}]),angular.module("zcloud").filter("typeToCol",function(){var a={1:"col-sm-4",2:"col-sm-8",3:"col-sm-12"};return function(b){return a[b]||a[0]}}),angular.module("zcloud").filter("typeToImage",function(){var a={0:"custom.png",1:"switch.png",2:"light.png",3:"sensor-temperature.png",4:"sensor-humidity.png",5:"lightning.png",6:"human.png",7:"snake.png","0_1":"switch-off.png","1_1":"switch-on.png","0_2":"light-off.png","1_2":"light-on.png","0_6":"unhappy.png","1_6":"happy.png"};return function(b){return a[b]||a[0]}}),angular.module("zcloud").filter("typeToHtml",function(){var a={0:"custom.html",1:"switch.html",2:"light.html",3:"sensor-temperature-humidity.html"};return function(b,c){return c+(a[b]||a[0])}}),angular.module("zcloud").filter("typeToTemplateWidget",function(){var a={0:"widget.custom.html",1:"widget.onoff.tmpl.html",2:"widget.simplelamp.tmpl.html",3:"widget.temperature.tmpl.html",4:"widget.humidity.tmpl.html",5:"widget.light.tmpl.html",6:"widget.humanpresence.tmpl.html",7:"widget.smartsnake.tmpl.html"};return function(b){return a[b]||a[0]}}),angular.module("zcloud").filter("typeToWidgetSize",function(){var a={1:"30",2:"60",3:"100"};return function(b){return a[b]||a[0]}}),angular.module("zcloud").filter("typeToWidgetType",function(){var a={0:"00 (Custom)",1:"01 (Power switch)",2:"02 (Simple lamp)",3:"03 (Temperature sensor)",4:"04 (Humidity sensor)",5:"05 (Light sensor)",6:"06 (Human presence)",7:"07 (Smart snake)"};return function(b){return a[b]||a[0]}}),angular.module("zcloud").controller("MainCtrl",["$scope","$mdSidenav","User","$location","$window","$cookies",function(a,b,c,d,e,f){a.toggleSidenav=function(a){b(a).toggle()},a.login=function(){c.login(a.email,a.password,function(a,b){return a?void e.alert("Login error"):void 0}),a.showlogin=!0,d.path("/dashboard"),e.location.reload()},a.logout=function(){c.logout(),a.style="",d.path("/login"),e.location.reload()},a.search=function(){f.put("keysearch",a.key),d.path("/search")},a.init=function(){if(c.isLoggedIn()){a.style="sidebar-l sidebar-o side-scroll header-navbar-fixed sidebar-mini",a.showlogin=!0;var b=window.location.href.split("#/")[1];("dashboard"===b||"login"===b)&&d.path("/dashboard")}else a.style="",a.showlogin=!1,d.path("/login")},a.init()}]),angular.module("zcloud").controller("IndexCtrl",["$scope","$mdSidenav",function(a,b){a.toggleSidenav=function(a){b(a).toggle()},a.slides=[{href:"https://github.com/itead/IoTgo",src:"/images/home/slideshow/iot.jpg"},{href:"https://www.indiegogo.com/projects/iotgo-open-source-iot-cloud-solution",src:"/images/home/slideshow/indiegogo.jpg"}]}]),angular.module("zcloud").controller("NavSearch",["$scope","$cookies","User","Search","$location",function(a,b,c,d,e){return c.isLoggedIn()?void(a.key=b.get("keysearch")):void e.path("/login")}]),angular.module("zcloud").controller("NavCtrl",["$scope","User","$location","$cookies",function(a,b,c,d){a.isLoggedIn=b.isLoggedIn(),a.useremail=b.getUser().email,a.isLoggedIn?a.menu=[{title:"Dashboard",link:"#/dashboard",icon:"dashboard"},{title:"Devices",link:"#/devices",icon:"dashboard"},{title:"Profile",link:"#/profile",icon:"dashboard"},{title:"About",link:"#/about",icon:"dashboard"},{title:"Logout",link:"#/login",icon:"dashboard"}]:(a.isLock="",a.menu=[{title:"Log in",link:"#/login",icon:"dashboard"},{title:"Signup",link:"#/signup",icon:"dashboard"}])}]),angular.module("zcloud").controller("LoginCtrl",["$scope","$window","$location","User",function(a,b,c,d){a.init=function(){},a.init(),a.login=function(){d.login(a.email,a.password,function(a,c){return a?void b.alert(a):(window.location.href="/dashboard",void b.location.reload())})}}]),angular.module("zcloud").controller("SignupCtrl",["$scope","$window","$location","User",function(a,b,c,d){a.register=function(){d.register(a.email,a.password,a.response,function(e){return e?void b.alert(e):void d.login(a.email,a.password,function(a,d){return a?void b.alert(a):void c.path("/login")})})}}]),angular.module("zcloud").controller("ProfileCtrl",["$scope","$window","$location","User",function(a,b,c,d){if(!d.isLoggedIn())return void c.path("/login");a.title="Profile",a.getEmail=function(){return d.getUser().email};var e=d.isActive();a.isDisabled=!e,a.getApikey=function(){return d.getUser().apikey},a.getToken=function(){return d.getToken()}}]),angular.module("zcloud").controller("DevicesCtrl",["$scope","$mdDialog","$mdMedia","$window","$location","User","Devices",function(a,b,c,d,e,f,g){if(!f.isLoggedIn())return void e.path("/login");var h;a.title="Devices",a.activeDevice=null,a.init=function(){sessionStorage.clear()},a.init(),a.showModal=function(a){var b=angular.element(a);b.on("shown.bs.modal",function(){angular.element("#datetimepicker").datetimepicker()}),b.modal()},a.showCreateDeviceDialog=function(d){var e=(c("sm")||c("xs"))&&a.customFullscreen;b.show({controller:"CreateDeviceDialogCtrl",templateUrl:"/views/dialog.createdevice.tmpl.html",parent:angular.element(document.body),targetEvent:d,clickOutsideToClose:!0,fullscreen:e}).then(function(b){"refresh"===b&&(a.device=null,a.devices=i(h,"group"))},function(){a.status="You cancelled the dialog."}),a.$watch(function(){return c("xs")||c("sm")},function(b){a.customFullscreen=b===!0})},a.hideModal=function(){angular.element(".modal").modal("hide")},a.createDevice=function(){return a.device&&a.device.name&&a.device.address&&a.device.type&&a.device.group?(g.save({name:a.device.name,address:a.device.address,type:a.device.type,group:a.device.group},function(){b.hide("refresh")},function(){d.alert("Create device failed! Please try again later.")}),void g.query(function(b){h=b,a.devices=i(h,"group")},function(){d.alert("Retrieve device list failed!")})):void d.alert("Device name, address, type, and group are required!")},a.addDevice=function(){return a.device&&a.device.name&&a.device.group&&a.device.deviceid&&a.device.apikey?void g.add({name:a.device.name,address:a.device.address,group:a.device.group,deviceid:a.device.deviceid,apikey:a.device.apikey},function(){a.hideModal(),a.device=null,a.devices=i(a.device,"group")},function(){d.alert("Add device failed! Please try again later.")}):void d.alert("Device name, group, id and api key are required!")},a.getDeviceInfo=function(b){a._deviceid=b.deviceid,a._devicename=b.name,a._deviceaddress=b.address,a._groupname=b.group,a.activeDevice=b},a.showDevice=function(d,e){a.activeDevice=d,a.activeDevice.params=a.activeDevice.params||{};var f=(c("sm")||c("xs"))&&a.customFullscreen;b.show({controller:"UpdateDeviceDialogCtrl",templateUrl:"/views/dialog.updatedevice.tmpl.html",parent:angular.element(document.body),targetEvent:e,locals:{device:a.activeDevice},clickOutsideToClose:!0,fullscreen:f}).then(function(b){"refresh"===b&&(a.device=null,a.devices=i(h,"group"))},function(){a.status="You cancelled the dialog."}),a.$watch(function(){return c("xs")||c("sm")},function(b){a.customFullscreen=b===!0})},a.saveDevice=function(){return a.activeDevice&&a.activeDevice.name&&a.activeDevice.group?void a.activeDevice.$save(function(b){return b.error?void d.alert(b.reason):void(a.devices=i(h,"group"))},function(){d.alert("Save device failed! Please try again later.")}):void d.alert("Device name and group are required!")},a.updateDevice=function(b,c){return a.activeDevice&&b&&c?(a.activeDevice.name=b,a.activeDevice.group=c,void a.activeDevice.$save(function(b){return b.error?void d.alert(b.reason):void(a.devices=i(h,"group"))},function(){d.alert("Save device failed! Please try again later.")})):void d.alert("Device name and group are required!")},a.deleteDevice=function(c){var d=b.confirm().title("Delete confirmation").textContent("You really want to delete this device?").ok("Delete").cancel("Cancel");b.show(d).then(function(b){d=void 0,console.log("You confirm delete the dialog."),g.remove(c.deviceid,function(){a.devices=i(h,"group"),a.activeDevice=null},function(){a.alert("Delete device failed! Please try again later.")})},function(){d=void 0,console.log("You cancelled the dialog.")})},a.alert=function(a){var c=b.alert().title("Information").textContent(a).ok("Close");b.show(c)["finally"](function(){c=void 0})},a.turnOn=function(a,b){m(a,b,"on")},a.turnOff=function(a,b){m(a,b,"off")},a.isDeviceOnline=function(a){return a&&l(a)?a.online?"Device Online":" Device Offline":!1},a.addTimer=function(b){var c=angular.element("#timerAt").val(),e=angular.element("#timerAction label.active input").val();if(!c||!e)return void d.alert("Please specify timer details!");var f={enabled:!0,type:"once",at:new Date(c).toISOString(),"do":{}};f["do"][b]=e;var g=angular.extend([],a.activeDevice.params.timers||[]);g.push(f),m(a.activeDevice,"timers",g)},a.removeTimer=function(b){var c=angular.extend([],a.activeDevice.params.timers);c.splice(c.indexOf(b),1),m(a.activeDevice,"timers",c)};var i=function(a,b){if(!angular.isArray(a)||!angular.isString(b))return a;var c={};return angular.forEach(a,function(a){var d=a[b];return a.battery=0,d?(c[d]=c[d]||[],void c[d].push(a)):(c["Default Group"]=c["Default Group"]||[],void c["Default Group"].push(a))}),c},j=null,k=function(a){return l(a)?Object.keys(a).length?j?(d.alert("Request in progress, please wait for a moment."),!1):!0:(d.alert("Device status is unknown, please wait for a moment."),!1):!0},l=function(a){return!0},m=function(b,c,e){k(b)&&(j={params:{}},j.params[c]=e,g.send({action:"update",apikey:b.apikey,deviceid:b.deviceid,params:j.params},function(){a.$apply(function(){angular.extend(b.params,j.params)}),j=null},function(){d.alert("Operation failed, please try again later."),j=null}))};g.query(function(b){h=b,a.devices=i(h,"group")},function(){d.alert("Retrieve device list failed!")}),a.isDisabled=!1}]),angular.module("zcloud").controller("TipCtrl",["$scope","$window","User",function(a,b,c){a.hideSpan=function(){$("#checkActiveSpan").hide(),c.activeAccount(function(){})}}]),angular.module("zcloud").controller("DashboardCtrl",["$scope","$window","$location","$interval","$cookies","$mdDialog","$mdMedia","User","Devices","WS","Widgets","Dashboard",function(a,b,c,d,e,f,g,h,i,j,k,l){if(!h.isLoggedIn())return void c.path("/login");var m,n;a.data={devices:[]},a.title="Dashboard";var o="",p="";a.defaultWidgets=[];var q=function(a,b){if(!angular.isArray(a)||!angular.isString(b))return a;var c={};return angular.forEach(a,function(a){var d=a[b];return d?(c[d]=c[d]||[],void c[d].push(a)):(c["Default Group"]=c["Default Group"]||[],void c["Default Group"].push(a))}),c};a.init=function(){l.init(),a.username=h.getUser().email,i.query(function(b){m=b,a.data.devices=m,a.totaldevices=m.length;var c,d=q(m,"group"),e=[];for(var f in d)c={},c.type=f,c.name=d[f],e.push(c);a.totalgroups=e.length},function(){b.alert("Retrieve device list failed!")}),k.query(function(b){n=b,a.widgets=n,a.totalwidgets=a.widgets.length},function(){b.alert("Retrieve device list failed!")})},a.init(),a.selectDevice=function(){var b,c=a.widget.deviceId;i.get(c,function(c){b=c,o=b.name,p=b.type,(void 0===a.widget.name||""===a.widget.name)&&(a.widget.name=o)})},a.createWidget=function(){return a.widget&&a.widget.deviceId&&a.widget.size?void k.add({device_id:a.widget.deviceId,type:p,name:a.widget.name,size:a.widget.size},function(){f.hide("refresh")},function(){b.alert("Add widget failed! Please try again later.")}):void b.alert("Widget settings are required!")},a.showAddWidget=function(b){var c=(g("sm")||g("xs"))&&a.customFullscreen;f.show({controller:"AddWidgetDialogCtrl",templateUrl:"/views/dialog.addwidget.tmpl.html",parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:!0,fullscreen:c}).then(function(a){},function(){a.status="You cancelled the dialog."}),a.$watch(function(){return g("xs")||g("sm")},function(b){a.customFullscreen=b===!0})}}]),angular.module("zcloud").controller("PageContentCtrl",["$scope","$mdSidenav","$controller",function(a,b,c){a.toggleSidenav=function(a){b(a).toggle()}}]),angular.module("zcloud").controller("CreateDeviceDialogCtrl",["$scope","$mdDialog","$window","Devices",function(a,b,c,d){a.hide=function(){b.hide()},a.cancel=function(){b.cancel()},a.closeDialog=function(){b.cancel()},a.answer=function(a){b.hide(a)},a.createDevice=function(){return a.device&&a.device.name&&a.device.address&&a.device.type&&a.device.group?void d.save({name:a.device.name,address:a.device.address,type:a.device.type,group:a.device.group},function(){b.hide("refresh")},function(){c.alert("Create device failed! Please try again later.")}):void c.alert("Device name, address, type, and group are required!")}}]),angular.module("zcloud").controller("UpdateDeviceDialogCtrl",["$scope","$mdDialog","$window","Devices","device",function(a,b,c,d,e){a.activeDevice=e,a.hide=function(){b.hide()},a.cancel=function(){b.cancel()},a.closeDialog=function(){b.cancel()},a.answer=function(a){b.hide(a)},a.saveDevice=function(){return a.activeDevice&&a.activeDevice.name&&a.activeDevice.group?void a.activeDevice.$save(function(a){return a.error?void c.alert(a.reason):void b.hide("refresh")},function(){c.alert("Save device failed! Please try again later.")}):void c.alert("Device name and group are required!")},a.deleteDevice=function(){c.confirm("You really want to delete this device?")&&d.remove(a.activeDevice.deviceid,function(){b.hide("refresh")},function(){c.alert("Delete device failed! Please try again later.")})}}]),angular.module("zcloud").controller("AddWidgetDialogCtrl",["$scope","$mdDialog","$window","Widgets","Devices",function(a,b,c,d,e){var f="",g="";a.data={devices:[]},a.init=function(){e.query(function(b){a.data.devices=b},function(){console.log("cannot query devices")})},a.init(),a.widget={type:1},a.hide=function(){b.hide()},a.cancel=function(){b.cancel()},a.closeDialog=function(){b.cancel()},a.answer=function(a){b.hide(a)},a.addWidget=function(){return a.widget&&a.widget.deviceId?void d.add({device_id:a.widget.deviceId,type:g,name:a.widget.name,size:a.widget.size},function(){b.hide("refresh")},function(){c.alert("Add widget failed! Please try again later.")}):void c.alert("Widget settings are required!")},a.selectWidget=function(){},a.selectDevice=function(){var b,c=a.widget.deviceId;e.get(c,function(c){b=c,f=b.name,g=b.type,(void 0===a.widget.name||""===a.widget.name)&&(a.widget.name=f)})}}]),angular.module("zcloud").controller("UpdateWidgetDialogCtrl",["$scope","$mdDialog","$window","Devices","Widgets","widget",function(a,b,c,d,e,f){a.widget=f,a.data={devices:[]},a.widget.deviceId="",a.init=function(){var b=a.widget.device_id;d.query(function(c){a.data.devices=c,d.get(b,function(b){a.params=b.params})},function(){console.log("cannot query devices")}),a.widget.deviceId=b},a.init(),a.hide=function(){b.hide()},a.cancel=function(){b.cancel()},a.closeDialog=function(){b.cancel()},a.answer=function(a){b.hide(a)},a.saveWidget=function(){return a.widget.device_id=a.widget.deviceId,a.widget&&a.widget.name&&a.widget.device_id?void e.save(a.widget,function(a){return void 0!==a&&a.error?void c.alert(a.reason):void b.hide("refresh")},function(){c.alert("Save widget failed! Please try again later.")}):void c.alert("Widget name and device are required!")},a.deleteWidget=function(){c.confirm("You really want to delete this widget?")&&e.remove(a.widget.id,function(){b.hide("refresh")},function(){c.alert("Delete widget failed! Please try again later.")})},a.selectDevice=function(){var b=a.widget.deviceId;d.get(b,function(b){a.params=b.params})}}]),angular.module("zcloud").controller("HistoryDialogCtrl",["$scope","$mdDialog","$window","Devices","Widgets","widget",function(a,b,c,d,e,f){a.widget=f,a.data={devices:[]},a.widget.deviceId="",a.totalItems=0,a.itemPerPage=5,a.currentPage=1,a.init=function(){a.widgetName=a.widget.name;var b=19;d.history(b,a.widget.device_id,function(b){a.logs=b,a.totalItems=a.logs.length,a.totalPages=parseInt(a.totalItems/a.itemPerPage)+1,a.totalItems%a.itemPerPage===0&&(a.totalPages=parseInt(a.totalItems/a.itemPerPage)),a.pageChanged()})},a.items=function(){for(var b=[],c=a.totalPages,d=1;c>=d;d++)b.push(d);return b},a.getFistPage=function(){a.currentPage=1,a.pageChanged()},a.getLastPage=function(){a.currentPage=a.totalPages,a.pageChanged()},a.getCurrentPage=function(b){a.currentPage=b,a.pageChanged()},a.pageChanged=function(){var b=0,c=JSON.parse('{"data":[]}'),d=0,e=d+4;0>e&&(e=0);for(var f=d;e>=f;f++){var g=new Date(1e3*a.logs[f].localTime);a.logs[f].time=g.toLocaleDateString()+" "+g.toLocaleTimeString(),a.logs[f].seq=b+1,a.logs[f].no=(a.currentPage-1)*a.itemPerPage+b+1,a.logs[f].source="Unknown",b++,c.data.push(a.logs[f])}a.logCurrentPage=c.data},a.init(),a.hide=function(){b.hide()},a.cancel=function(){b.cancel()},a.closeDialog=function(){b.cancel()},a.answer=function(a){b.hide(a)}}]),function(){function a(a,b){var c=this;c.widget=a.$parent.widget,c.device={},c.deviceValue=void 0,c.getValue=function(){if(void 0!==c.device.params)for(var a=0;a<c.device.params.length;a++){var b=c.device.params[a];if(b.varId===c.widget.variable_id)return b.value}},console.log("Register scope: ","DEVICE_DATA_UPDATE_"+c.widget.device_id),a.$on("DEVICE_DATA_UPDATE_"+c.widget.device_id,function(a,b){c.device.value=c.device.value||{},angular.extend(c.device.value,b.value),c.deviceValue=b.value,c.typeImg=c.deviceValue+"_"+c.widget.type,console.log("Device value updated:",c.deviceValue)}),b.get(c.widget.device_id,function(a){console.log("Device:",a),c.device=a,c.deviceValue=c.device.value,c.typeImg=c.deviceValue+"_"+c.widget.type,console.log("Device value:",c.deviceValue)})}angular.module("zcloud").controller("WidgetOnOffController",["$scope","Devices",a])}(),function(){function a(a,b){var c=this;c.widget=a.$parent.widget,c.device={},c.deviceValue=void 0,c.getValue=function(){if(void 0!==c.device.params)for(var a=0;a<c.device.params.length;a++){var b=c.device.params[a];if(b.varId===c.widget.variable_id)return b.value}},console.log("Register scope: ","DEVICE_DATA_UPDATE_"+c.widget.device_id),a.$on("DEVICE_DATA_UPDATE_"+c.widget.device_id,function(a,b){if(c.device.value=c.device.value||{},angular.extend(c.device.value,b.value),"0"===b.value?c.deviceValue="OFF":c.deviceValue="ON",""===c.device.localTime)c.localTime="undefined";else{var d=new Date(1e3*c.device.localTime);c.localTime=d.toLocaleDateString()+" "+d.toLocaleTimeString()}c.typeImg=b.value+"_"+c.widget.type,console.log("Device value updated:",c.deviceValue)}),b.get(c.widget.device_id,function(a){if(console.log("Device:",a),c.device=a,"0"===c.device.value?c.deviceValue="OFF":c.deviceValue="ON",""===c.device.localTime)c.localTime="undefined";else{var b=new Date(1e3*c.device.localTime);c.localTime=b.toLocaleDateString()+" "+b.toLocaleTimeString()}c.typeImg=c.device.value+"_"+c.widget.type,console.log("Device value:",c.deviceValue)})}angular.module("zcloud").controller("WidgetSimpleLampController",["$scope","Devices",a])}(),function(){function a(a,b){var c,d,e=this,f=[0,0,0,0,0,0,0,0,0,0],g=["","","","","","","","","",""],h={labels:g,datasets:[{fillColor:"rgba(171, 227, 125, .3)",strokeColor:"rgba(171, 227, 125, 1)",pointColor:"rgba(171, 227, 125, 1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(171, 227, 125, 1)",data:f}]},i=function(a){var b=a.labels,c=new Date(1e3*e.localTime);b.push(c.toLocaleDateString()+" "+c.toLocaleTimeString()),b.shift();var d=a.datasets[0].data,f=e.deviceValue;d.push(f),d.shift()},j={animation:!1,scaleFontFamily:"'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif",scaleFontColor:"#999",scaleFontStyle:"600",tooltipTitleFontFamily:"'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif",tooltipCornerRadius:3,scaleFontSize:0,responsive:!0};e.widget=a.$parent.widget,e.device={},e.deviceValue=void 0,e.lastTime=void 0,e.getValue=function(){if(void 0!==e.device.params)for(var a=0;a<e.device.params.length;a++){var b=e.device.params[a];if(b.varId===e.widget.variable_id)return b.value}},console.log("Register scope: ","DEVICE_DATA_UPDATE_"+e.widget.device_id),a.$on("DEVICE_DATA_UPDATE_"+e.widget.device_id,function(a,b){if(e.device.value=e.device.value||{},angular.extend(e.device.value,b.value),e.deviceValue=b.value,e.localTime=b.localTime,document.getElementById(e.valueid).innerHTML=e.deviceValue.toString()+" lux",""===b.localTime)document.getElementById(e.localtimeid).innerHTML="undefined";else{var c=new Date(1e3*b.localTime);document.getElementById(e.localtimeid).innerHTML=c.toLocaleDateString()+" "+c.toLocaleTimeString()}e.typeImg=e.widget.type,i(h),d.Line(h,j),console.log("Device value updated:",e.deviceValue)}),b.get(e.widget.device_id,function(a){console.log("Device:",a),e.device=a,e.deviceValue=e.device.value,e.valueid="value_"+e.widget.device_id.toString(),e.localtimeid="localtime_"+e.widget.device_id.toString(),e.typeImg=e.widget.type,e.chartid=e.widget.device_id.toString();var i=9;b.history(i,e.widget.device_id,function(a){console.log("History:",a);for(var b=0;b<a.length&&10!==b;b++){f[i-b]=a[b].value;var k=new Date(1e3*a[b].localTime);g[i-b]=k.toLocaleDateString()+" "+k.toLocaleTimeString()}if(c=document.getElementById(e.chartid).getContext("2d"),d=new Chart(c),d.Line(h,j),document.getElementById(e.valueid).innerHTML=e.deviceValue.toString()+" lux",""===e.device.localTime)document.getElementById(e.localtimeid).innerHTML="undefined";else{var k=new Date(1e3*e.device.localTime);document.getElementById(e.localtimeid).innerHTML=k.toLocaleDateString()+" "+k.toLocaleTimeString()}}),console.log("Device value:",e.deviceValue)})}angular.module("zcloud").controller("WidgetLightController",["$scope","Devices",a])}(),function(){function a(a,b){var c,d,e=this,f=[0,0,0,0,0,0,0,0,0,0],g=["","","","","","","","","",""],h={labels:g,datasets:[{fillColor:"rgba(171, 227, 125, .3)",strokeColor:"rgba(171, 227, 125, 1)",pointColor:"rgba(171, 227, 125, 1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(171, 227, 125, 1)",data:f}]},i=function(a){var b=a.labels,c=new Date(1e3*e.localTime);b.push(c.toLocaleDateString()+" "+c.toLocaleTimeString()),b.shift();var d=a.datasets[0].data,f=e.deviceValue;d.push(f),d.shift()},j={animation:!1,scaleFontFamily:"'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif",scaleFontColor:"#999",scaleFontStyle:"600",tooltipTitleFontFamily:"'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif",tooltipCornerRadius:3,scaleFontSize:0,responsive:!0};e.widget=a.$parent.widget,e.device={},e.deviceValue=void 0,e.getValue=function(){if(void 0!==e.device.value)for(var a=0;a<e.device.length;a++){var b=e.device[a];if(b.deviceid===e.widget.device_id)return b.value}},console.log("Register scope: ","DEVICE_DATA_UPDATE_"+e.widget.device_id),a.$on("DEVICE_DATA_UPDATE_"+e.widget.device_id,function(a,b){if(e.device.value=e.device.value||{},console.log("Data update: ",b),angular.extend(e.device.value,b.value),e.device.value=b.value,e.deviceValue=e.device.value,document.getElementById(e.valueid).innerHTML=e.deviceValue.toString()+" &#8451;",""===e.device.localTime)document.getElementById(e.localtimeid).innerHTML="undefined";else{var c=new Date(1e3*b.localTime);document.getElementById(e.localtimeid).innerHTML=c.toLocaleDateString()+" "+c.toLocaleTimeString(),e.localTime=b.localTime,i(h),d.Line(h,j),e.typeImg=e.widget.type,console.log("Device value updated:",e.deviceValue)}}),b.get(e.widget.device_id,function(a){console.log("Device:",a),e.device=a,e.deviceValue=e.device.value,e.typeImg=e.widget.type,e.valueid="value_"+e.widget.device_id.toString(),e.localtimeid="localtime_"+e.widget.device_id.toString(),e.chartid="chart_"+e.widget.device_id.toString();var i=9;b.history(i,e.widget.device_id,function(a){console.log("History:",a);for(var b=0;b<a.length&&10!==b;b++){f[i-b]=a[b].value;var k=new Date(1e3*a[b].localTime);g[i-b]=k.toLocaleDateString()+" "+k.toLocaleTimeString();
}if(c=document.getElementById(e.chartid).getContext("2d"),d=new Chart(c),d.Line(h,j),document.getElementById(e.valueid).innerHTML=e.deviceValue.toString()+" &#8451;",""===e.device.localTime)document.getElementById(e.localtimeid).innerHTML="undefined";else{var k=new Date(1e3*e.device.localTime);document.getElementById(e.localtimeid).innerHTML=k.toLocaleDateString()+" "+k.toLocaleTimeString()}}),console.log("Device value:",e.deviceValue)})}angular.module("zcloud").controller("WidgetTempController",["$scope","Devices",a])}(),function(){function a(a,b){var c,d,e=[0,0,0,0,0,0,0,0,0,0],f=["","","","","","","","","",""],g={labels:f,datasets:[{fillColor:"rgba(171, 227, 125, .3)",strokeColor:"rgba(171, 227, 125, 1)",pointColor:"rgba(171, 227, 125, 1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(171, 227, 125, 1)",data:e}]},h=function(a){var b=a.labels,c=new Date(1e3*j.localTime);b.push(c.toLocaleDateString()+" "+c.toLocaleTimeString()),b.shift();var d=a.datasets[0].data,e=j.deviceValue;d.push(e),d.shift()},i={animation:!1,scaleFontFamily:"'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif",scaleFontColor:"#999",scaleFontStyle:"600",tooltipTitleFontFamily:"'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif",tooltipCornerRadius:3,scaleFontSize:0,responsive:!0},j=this;j.widget=a.$parent.widget,j.device={},j.deviceValue=void 0,j.getValue=function(){if(void 0!==j.device.value)for(var a=0;a<j.device.length;a++){var b=j.device[a];if(b.deviceid===j.widget.device_id)return b.value}},console.log("Register scope: ","DEVICE_DATA_UPDATE_"+j.widget.device_id),a.$on("DEVICE_DATA_UPDATE_"+j.widget.device_id,function(a,b){if(j.device.value=j.device.value||{},angular.extend(j.device.value,b.value),j.deviceValue=b.value,document.getElementById(j.valueid).innerHTML=j.deviceValue.toString()+" %",""===b.localTime)document.getElementById(j.localtimeid).innerHTML="undefined";else{var c=new Date(1e3*b.localTime);document.getElementById(j.localtimeid).innerHTML=c.toLocaleDateString()+" "+c.toLocaleTimeString(),j.localTime=b.localTime,h(g),d.Line(g,i),console.log("Device value updated:",j.deviceValue)}}),b.get(j.widget.device_id,function(a){console.log("Device:",a),j.device=a,j.deviceValue=j.device.value,j.valueid="value_"+j.widget.device_id.toString(),j.localtimeid="localtime_"+j.widget.device_id.toString(),j.chartid=j.widget.device_id.toString();var h=9;b.history(h,j.widget.device_id,function(a){console.log("History:",a);for(var b=0;b<a.length&&10!==b;b++){e[h-b]=a[b].value;var k=new Date(1e3*a[b].localTime);f[h-b]=k.toLocaleDateString()+" "+k.toLocaleTimeString()}if(c=document.getElementById(j.chartid).getContext("2d"),d=new Chart(c),d.Line(g,i),document.getElementById(j.valueid).innerHTML=j.deviceValue.toString()+" %",""===j.device.localTime)document.getElementById(j.localtimeid).innerHTML="undefined";else{var k=new Date(1e3*j.device.localTime);document.getElementById(j.localtimeid).innerHTML=k.toLocaleDateString()+" "+k.toLocaleTimeString()}}),console.log("Device value:",j.deviceValue)})}angular.module("zcloud").controller("WidgetHumidityController",["$scope","Devices",a])}(),function(){function a(a,b){var c,d,e=this,f=[0,0,0,0,0],g={labels:["","","","",""],datasets:[{label:"My First dataset",fillColor:"rgba(220,220,220,0.2)",strokeColor:"rgba(220,220,220,1)",pointColor:"rgba(220,220,220,1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(220,220,220,1)",data:f}]},h=function(a){var b=a.datasets[0].data,c=e.deviceValue;b.push(c),b.shift()},i={animation:!1,scaleOverride:!0,scaleSteps:20,scaleStepWidth:10,scaleStartValue:0},i={animation:!1};e.widget=a.$parent.widget,e.device={},e.deviceValue=void 0,e.getValue=function(){if(void 0!==e.device.params)for(var a=0;a<e.device.params.length;a++){var b=e.device.params[a];if(b.varId===e.widget.variable_id)return b.value}},console.log("Register scope: ","DEVICE_DATA_UPDATE_"+e.widget.device_id),a.$on("DEVICE_DATA_UPDATE_"+e.widget.device_id,function(a,b){e.device.value=e.device.value||{},angular.extend(e.device.value,b.value),e.deviceValue=b.value,h(g),d.Line(g,i),console.log("Device value updated:",e.deviceValue)}),b.get(e.widget.device_id,function(a){console.log("Device:",a),e.device=a,e.deviceValue=e.device.value,e.id=e.widget.id,c=document.getElementById("xxx").getContext("2d"),d=new Chart(c),h(g),d.Line(g,i),console.log("Device value:",e.deviceValue)})}angular.module("zcloud").controller("WidgetLiveChartController",["$scope","Devices",a])}(),function(){function a(a,b){var c=this;c.widget=a.$parent.widget,c.device={},c.deviceValue=void 0,c.getValue=function(){if(void 0!==c.device.params)for(var a=0;a<c.device.params.length;a++){var b=c.device.params[a];if(b.varId===c.widget.variable_id)return b.value}},console.log("Register scope: ","DEVICE_DATA_UPDATE_"+c.widget.device_id),a.$on("DEVICE_DATA_UPDATE_"+c.widget.device_id,function(a,b){if(c.device.value=c.device.value||{},angular.extend(c.device.value,b.value),"0"===b.value?c.deviceValue="No person":c.deviceValue="Have human presence",""===c.device.localTime)c.localTime="undefined";else{var d=new Date(1e3*c.device.localTime);c.localTime=d.toLocaleDateString()+" "+d.toLocaleTimeString()}c.typeImg=b.value+"_"+c.widget.type,console.log("Device value updated:",c.deviceValue)}),b.get(c.widget.device_id,function(a){if(console.log("Device:",a),c.device=a,"0"===c.device.value?c.deviceValue="No person":c.deviceValue="Have human presence",""===c.device.localTime)c.localTime="undefined";else{var b=new Date(1e3*c.device.localTime);c.localTime=b.toLocaleDateString()+" "+b.toLocaleTimeString()}c.typeImg=c.device.value+"_"+c.widget.type,console.log("Device value:",c.deviceValue)})}angular.module("zcloud").controller("WidgetHumanPresenceController",["$scope","Devices",a])}(),function(){function a(a,b){var c,d,e=this,f=[],g=[],h={labels:g,datasets:[{label:"My First dataset",fillColor:"rgba(220,220,220,0.2)",strokeColor:"rgba(220,220,220,1)",pointColor:"rgba(220,220,220,1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(220,220,220,1)",data:f}]},i=function(a){var b=a.datasets[0].data,c=e.deviceValue;b.push(c),b.shift()},j={animation:!1,scaleOverride:!0,scaleSteps:20,scaleStepWidth:10,scaleStartValue:0},j={animation:!1};e.widget=a.$parent.widget,e.device={},e.deviceValue=void 0,e.getValue=function(){if(void 0!==e.device.value)for(var a=0;a<e.device.length;a++){var b=e.device[a];if(b.deviceid===e.widget.device_id)return b.value}},console.log("Register scope: ","DEVICE_DATA_UPDATE_"+e.widget.device_id),a.$on("DEVICE_DATA_UPDATE_"+e.widget.device_id,function(a,b){if(e.device.value=e.device.value||{},angular.extend(e.device.value,b.value),e.deviceValue=b.value,""===e.device.localTime)e.localTime="undefined";else{var c=new Date(1e3*e.device.localTime);e.localTime=c.toLocaleDateString()+" "+c.toLocaleTimeString()}e.typeImg=e.widget.type,i(h),d.Line(h,j),console.log("Device value updated:",e.deviceValue)}),b.get(e.widget.device_id,function(a){if(console.log("Device:",a),e.device=a,e.deviceValue=e.device.value,""===e.device.localTime)e.localTime="undefined";else{var i=new Date(1e3*e.device.localTime);e.localTime=i.toLocaleDateString()+" "+i.toLocaleTimeString()}e.typeImg=e.widget.type,b.history(e.widget.device_id,function(a){console.log("History:",a);for(var b=0;b<a.length;b++)f[b]=a[b].value,g[b]="";c=document.getElementById("chartAreaSnake").getContext("2d"),d=new Chart(c),d.Line(h,j)}),console.log("Device value:",e.deviceValue)})}angular.module("zcloud").controller("WidgetSmartSnakeController",["$scope","Devices",a])}(),angular.module("gRecaptcha",[]).directive("gRecaptcha",function(){return{require:"ngModel",restrict:"A",scope:{response:"=ngModel"},link:function(a,b,c){sitekey=c.gRecaptchaSitekey,grecaptcha&&sitekey&&(theme=c.gRecaptchaTheme||"light",type=c.gRecaptchaType||"image",grecaptcha.render(b[0],{sitekey:sitekey,theme:theme,type:type,callback:function(b){a.response=b}}))}}}),angular.module("zcloud").directive("userAvatar",function(){return{replace:!0,template:'<svg class="user-avatar" viewBox="0 0 128 128" height="64" width="64" pointer-events="none" display="block" > <path fill="#FF8A80" d="M0 0h128v128H0z"/> <path fill="#FFE0B2" d="M36.3 94.8c6.4 7.3 16.2 12.1 27.3 12.4 10.7-.3 20.3-4.7 26.7-11.6l.2.1c-17-13.3-12.9-23.4-8.5-28.6 1.3-1.2 2.8-2.5 4.4-3.9l13.1-11c1.5-1.2 2.6-3 2.9-5.1.6-4.4-2.5-8.4-6.9-9.1-1.5-.2-3 0-4.3.6-.3-1.3-.4-2.7-1.6-3.5-1.4-.9-2.8-1.7-4.2-2.5-7.1-3.9-14.9-6.6-23-7.9-5.4-.9-11-1.2-16.1.7-3.3 1.2-6.1 3.2-8.7 5.6-1.3 1.2-2.5 2.4-3.7 3.7l-1.8 1.9c-.3.3-.5.6-.8.8-.1.1-.2 0-.4.2.1.2.1.5.1.6-1-.3-2.1-.4-3.2-.2-4.4.6-7.5 4.7-6.9 9.1.3 2.1 1.3 3.8 2.8 5.1l11 9.3c1.8 1.5 3.3 3.8 4.6 5.7 1.5 2.3 2.8 4.9 3.5 7.6 1.7 6.8-.8 13.4-5.4 18.4-.5.6-1.1 1-1.4 1.7-.2.6-.4 1.3-.6 2-.4 1.5-.5 3.1-.3 4.6.4 3.1 1.8 6.1 4.1 8.2 3.3 3 8 4 12.4 4.5 5.2.6 10.5.7 15.7.2 4.5-.4 9.1-1.2 13-3.4 5.6-3.1 9.6-8.9 10.5-15.2M76.4 46c.9 0 1.6.7 1.6 1.6 0 .9-.7 1.6-1.6 1.6-.9 0-1.6-.7-1.6-1.6-.1-.9.7-1.6 1.6-1.6zm-25.7 0c.9 0 1.6.7 1.6 1.6 0 .9-.7 1.6-1.6 1.6-.9 0-1.6-.7-1.6-1.6-.1-.9.7-1.6 1.6-1.6z"/> <path fill="#E0F7FA" d="M105.3 106.1c-.9-1.3-1.3-1.9-1.3-1.9l-.2-.3c-.6-.9-1.2-1.7-1.9-2.4-3.2-3.5-7.3-5.4-11.4-5.7 0 0 .1 0 .1.1l-.2-.1c-6.4 6.9-16 11.3-26.7 11.6-11.2-.3-21.1-5.1-27.5-12.6-.1.2-.2.4-.2.5-3.1.9-6 2.7-8.4 5.4l-.2.2s-.5.6-1.5 1.7c-.9 1.1-2.2 2.6-3.7 4.5-3.1 3.9-7.2 9.5-11.7 16.6-.9 1.4-1.7 2.8-2.6 4.3h109.6c-3.4-7.1-6.5-12.8-8.9-16.9-1.5-2.2-2.6-3.8-3.3-5z"/> <circle fill="#444" cx="76.3" cy="47.5" r="2"/> <circle fill="#444" cx="50.7" cy="47.6" r="2"/> <path fill="#444" d="M48.1 27.4c4.5 5.9 15.5 12.1 42.4 8.4-2.2-6.9-6.8-12.6-12.6-16.4C95.1 20.9 92 10 92 10c-1.4 5.5-11.1 4.4-11.1 4.4H62.1c-1.7-.1-3.4 0-5.2.3-12.8 1.8-22.6 11.1-25.7 22.9 10.6-1.9 15.3-7.6 16.9-10.2z"/> </svg>'}}).directive("zcUserAvatar",function(){return{replace:!0,template:'<svg class="md-user-avatar" viewBox="0 0 128 128" height="40" width="40" pointer-events="none" display="block" > <path fill="#FF8A80" d="M0 0h128v128H0z"/> <path fill="#FFE0B2" d="M36.3 94.8c6.4 7.3 16.2 12.1 27.3 12.4 10.7-.3 20.3-4.7 26.7-11.6l.2.1c-17-13.3-12.9-23.4-8.5-28.6 1.3-1.2 2.8-2.5 4.4-3.9l13.1-11c1.5-1.2 2.6-3 2.9-5.1.6-4.4-2.5-8.4-6.9-9.1-1.5-.2-3 0-4.3.6-.3-1.3-.4-2.7-1.6-3.5-1.4-.9-2.8-1.7-4.2-2.5-7.1-3.9-14.9-6.6-23-7.9-5.4-.9-11-1.2-16.1.7-3.3 1.2-6.1 3.2-8.7 5.6-1.3 1.2-2.5 2.4-3.7 3.7l-1.8 1.9c-.3.3-.5.6-.8.8-.1.1-.2 0-.4.2.1.2.1.5.1.6-1-.3-2.1-.4-3.2-.2-4.4.6-7.5 4.7-6.9 9.1.3 2.1 1.3 3.8 2.8 5.1l11 9.3c1.8 1.5 3.3 3.8 4.6 5.7 1.5 2.3 2.8 4.9 3.5 7.6 1.7 6.8-.8 13.4-5.4 18.4-.5.6-1.1 1-1.4 1.7-.2.6-.4 1.3-.6 2-.4 1.5-.5 3.1-.3 4.6.4 3.1 1.8 6.1 4.1 8.2 3.3 3 8 4 12.4 4.5 5.2.6 10.5.7 15.7.2 4.5-.4 9.1-1.2 13-3.4 5.6-3.1 9.6-8.9 10.5-15.2M76.4 46c.9 0 1.6.7 1.6 1.6 0 .9-.7 1.6-1.6 1.6-.9 0-1.6-.7-1.6-1.6-.1-.9.7-1.6 1.6-1.6zm-25.7 0c.9 0 1.6.7 1.6 1.6 0 .9-.7 1.6-1.6 1.6-.9 0-1.6-.7-1.6-1.6-.1-.9.7-1.6 1.6-1.6z"/> <path fill="#E0F7FA" d="M105.3 106.1c-.9-1.3-1.3-1.9-1.3-1.9l-.2-.3c-.6-.9-1.2-1.7-1.9-2.4-3.2-3.5-7.3-5.4-11.4-5.7 0 0 .1 0 .1.1l-.2-.1c-6.4 6.9-16 11.3-26.7 11.6-11.2-.3-21.1-5.1-27.5-12.6-.1.2-.2.4-.2.5-3.1.9-6 2.7-8.4 5.4l-.2.2s-.5.6-1.5 1.7c-.9 1.1-2.2 2.6-3.7 4.5-3.1 3.9-7.2 9.5-11.7 16.6-.9 1.4-1.7 2.8-2.6 4.3h109.6c-3.4-7.1-6.5-12.8-8.9-16.9-1.5-2.2-2.6-3.8-3.3-5z"/> <circle fill="#444" cx="76.3" cy="47.5" r="2"/> <circle fill="#444" cx="50.7" cy="47.6" r="2"/> <path fill="#444" d="M48.1 27.4c4.5 5.9 15.5 12.1 42.4 8.4-2.2-6.9-6.8-12.6-12.6-16.4C95.1 20.9 92 10 92 10c-1.4 5.5-11.1 4.4-11.1 4.4H62.1c-1.7-.1-3.4 0-5.2.3-12.8 1.8-22.6 11.1-25.7 22.9 10.6-1.9 15.3-7.6 16.9-10.2z"/> </svg>'}}),angular.module("zcloud").directive("zcFooter",function(){return{restrict:"E",replace:!0,transclude:!1,templateUrl:"/views/footer.html"}}),angular.module("zcloud").directive("zcMainMenu",function(){return{restrict:"E",replace:!0,transclude:!1,templateUrl:"/views/main-menu.html"}}),angular.module("zcloud").controller("PanelWidgetController",["$scope","$window","$location","$interval","$cookies","$mdDialog","$mdMedia","User","Devices","Dashboard","WS","Widgets",function(a,b,c,d,e,f,g,h,i,j,k,l){a.showHistory=function(b,c){var d=(g("sm")||g("xs"))&&a.customFullscreen;f.show({controller:"HistoryDialogCtrl",templateUrl:"/views/dialog.history.tmpl.html",parent:angular.element(document.body),targetEvent:c,locals:{widget:b},clickOutsideToClose:!0,fullscreen:d}).then(function(a){},function(){a.status="You cancelled the dialog."}),a.$watch(function(){return g("xs")||g("sm")},function(b){a.customFullscreen=b===!0})},a.showWidgetSettings=function(b,c){var d=(g("sm")||g("xs"))&&a.customFullscreen;f.show({controller:"UpdateWidgetDialogCtrl",templateUrl:"/views/dialog.updatewidget.tmpl.html",parent:angular.element(document.body),targetEvent:c,locals:{widget:b},clickOutsideToClose:!0,fullscreen:d}).then(function(a){},function(){a.status="You cancelled the dialog."}),a.$watch(function(){return g("xs")||g("sm")},function(b){a.customFullscreen=b===!0})},a.deleteWidget=function(a){var c=f.confirm().title("Delete confirmation").textContent("You really want to delete this widget?").ok("Delete").cancel("Cancel");f.show(c).then(function(d){c=void 0,console.log("You confirm delete the dialog."),l.remove(a.id,function(){f.hide("refresh")},function(){b.alert("Delete widget failed! Please try again later.")})},function(){c=void 0,console.log("You cancelled the dialog.")})}}]).directive("panelWidget",function(){return{restrict:"E",replace:!0,transclude:!0,scope:{title:"@",template:"@",options:"@",widget:"="},templateUrl:"/views/widget.chrome.tmpl.html",controller:"PanelWidgetController",compile:function(a,b,c){return function(a,b){c(a,function(a){b.append(a)})}}}});